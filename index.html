<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Para mamorcito üíñ</title>
  <style>
    :root{
      /* Paleta celeste / azul */
      --bg1:#dbeafe;   /* blue-100 */
      --bg2:#cffafe;   /* cyan-100 */
      --bg3:#e0f2fe;   /* sky-100 */
      --card:#ffffffcc;
      --txt:#0f172a;   /* slate-900 */
      --muted:#475569; /* slate-600 */
      --accent:#38bdf8;  /* sky-400 */
      --accent2:#60a5fa; /* blue-400 */
      --accent3:#22d3ee; /* cyan-400 */
      --shadow: 0 18px 60px rgba(2, 6, 23, .18);
      --radius: 22px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--txt);

      /* ‚úÖ ahora s√≠ se puede scrollear */
      overflow-x:hidden;
      overflow-y:auto;

      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:22px 0 56px;

      background:
        radial-gradient(1200px 700px at 18% 20%, rgba(56,189,248,.20), transparent 60%),
        radial-gradient(900px 600px at 82% 75%, rgba(96,165,250,.18), transparent 55%),
        radial-gradient(900px 600px at 60% 18%, rgba(34,211,238,.14), transparent 58%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    /* fondo cute */
    .bg-stickers{
      position:fixed; inset:0;
      opacity:.18;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 12% 24%, rgba(56,189,248,.55) 0 2px, transparent 3px),
        radial-gradient(circle at 78% 18%, rgba(96,165,250,.45) 0 2px, transparent 3px),
        radial-gradient(circle at 55% 82%, rgba(34,211,238,.45) 0 2px, transparent 3px),
        radial-gradient(circle at 30% 70%, rgba(59,130,246,.35) 0 2px, transparent 3px);
      filter: blur(.2px);
    }

    .wrap{
      width:min(760px, 92vw);
      position:relative;
      z-index:2;
    }

    .card{
      background:var(--card);
      backdrop-filter: blur(10px);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid rgba(56,189,248,.25);
      overflow:hidden;
    }

    .header{
      padding:16px 18px 12px;
      display:flex;
      align-items:center;
      gap:12px;
      border-bottom:1px solid rgba(2,6,23,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.45));
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(56,189,248,.14);
      border:1px solid rgba(56,189,248,.22);
      font-weight:900;
      font-size:14px;
    }
    .title{
      margin-left:auto;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
    }

    /* barra estilo ‚Äústory‚Äù */
    .storybar{
      height:6px;
      background: rgba(2,6,23,.06);
      position:relative;
      overflow:hidden;
    }
    .storybar > span{
      position:absolute; inset:0;
      width:0%;
      background: linear-gradient(90deg, var(--accent3), var(--accent2));
      transition: width .25s ease;
    }

    .stage{
      position:relative;
      padding:18px;
      /* ‚úÖ el alto lo pondr√° JS seg√∫n el panel activo */
      height:auto;
    }

    /* paneles apilados pero con ancho normal */
    .panel{
      position:absolute;
      left:18px;
      right:18px;
      top:18px;

      width:auto;
      max-width:600px;
      margin:0 auto;

      padding:18px;
      border-radius:18px;
      background:rgba(255,255,255,.75);
      border:1px solid rgba(2,6,23,.06);
      box-shadow: 0 10px 30px rgba(2,6,23,.08);

      transform: translateY(10px);
      opacity:0;
      pointer-events:none;
      transition: opacity .35s ease, transform .35s ease;
    }
    .panel.active{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }


    /* responsive: en pantallas chicas, m√°s alto */
    @media (max-width:480px){
      .stage{ min-height: 620px; }
    }

    .big{
      font-size:28px;
      line-height:1.15;
      margin:6px 0 10px;
      text-align:center;
      font-weight:1000;
      letter-spacing:-0.02em;
    }
    .sub{
      text-align:center;
      font-size:16px;
      color:var(--muted);
      margin:0 0 14px;
      font-weight:700;
    }
    .cute{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      font-size:30px;
      margin:6px 0 6px;
    }

    .info{
      display:grid;
      gap:10px;
      margin:14px 0 6px;
      padding:12px 12px;
      border-radius:14px;
      background: rgba(56,189,248,.09);
      border: 1px dashed rgba(56,189,248,.36);
      font-size:15px;
    }
    .row{
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
    }
    .label{color:#0f172a; font-weight:950}
    .value{color:#0b1224; font-weight:850}
    .value small{color:var(--muted); font-weight:700}

    .actions{
      margin-top:14px;
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
    }

    button{
      border:none;
      border-radius:16px;
      padding:14px 16px;
      font-weight:950;
      font-size:16px;
      cursor:pointer;
      transition: transform .08s ease, filter .12s ease;
      user-select:none;
      touch-action: manipulation;
      min-width:220px;
    }
    button:active{transform: scale(.98)}
    .btnNext{
      background: linear-gradient(135deg, var(--accent2), var(--accent3));
      color:#07203a;
      box-shadow: 0 14px 28px rgba(56,189,248,.25);
    }
    .btnSoft{
      background:#fff;
      color:#0f172a;
      border:1px solid rgba(2,6,23,.10);
      box-shadow: 0 10px 18px rgba(2,6,23,.06);
    }
    button[disabled]{
      cursor:not-allowed;
      filter: grayscale(.15) opacity(.8);
    }

    /* escena del gato (sin salto) */
    .scene{
      position:relative;
      width:min(440px, 92vw);
      height:420px;
      margin: 10px auto 8px;
      border-radius:24px;
      background:
        radial-gradient(320px 240px at 50% 35%, rgba(56,189,248,.20), transparent 70%),
        radial-gradient(320px 240px at 50% 78%, rgba(34,211,238,.16), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.25));
      border:1px solid rgba(56,189,248,.22);
      overflow:hidden;
    }
    .floor{
      position:absolute;
      left:50%; bottom:42px;
      transform:translateX(-50%);
      width:72%;
      height:12px;
      border-radius:999px;
      background: rgba(56,189,248,.22);
      box-shadow: 0 12px 44px rgba(56,189,248,.22);
      filter: blur(.2px);
    }
    .spark{
      position:absolute;
      inset:-40px;
      pointer-events:none;
      background:
        radial-gradient(420px 260px at 30% 20%, rgba(96,165,250,.20), transparent 60%),
        radial-gradient(460px 280px at 80% 80%, rgba(34,211,238,.18), transparent 60%);
      animation: pulse var(--sparkDur, 1.35s) ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{opacity:.55}
      50%{opacity:1}
    }

    .catWrap{
      position:absolute;
      left:50%;
      bottom:58px;
      transform:translateX(-50%);
      width:min(250px, 70%);
      display:grid;
      place-items:center;
      z-index:2;
      filter: drop-shadow(0 18px 26px rgba(2,6,23,.22));
    }
    /* micro glow al tocar (sin mover el gif) */
    .catWrap.boost{ animation: glow 220ms ease-out 1; }
    @keyframes glow{
      from{ filter: drop-shadow(0 18px 26px rgba(2,6,23,.22)); }
      to{   filter: drop-shadow(0 24px 38px rgba(56,189,248,.35)); }
    }

    .cat{
      width:100%;
      user-select:none;
      -webkit-user-drag:none;
      image-rendering:auto;
    }

    #catStill{
      width:100%;
      height:auto;
      display:none;
    }

    /* Part√≠culas dentro de la escena */
    .floater{
      position:absolute;
      left:50%;
      top:55%;
      transform:translateX(-50%);
      font-size:18px;
      opacity:0;
      pointer-events:none;
      filter: drop-shadow(0 10px 14px rgba(2,6,23,.18));
      animation: pop 900ms ease-out forwards;
    }
    @keyframes pop{
      0%   { transform: translateX(-50%) translateY(0) scale(.8); opacity:0; }
      15%  { opacity:1; }
      100% { transform: translateX(calc(-50% + var(--dx))) translateY(var(--dy)) scale(1.25); opacity:0; }
    }

    /* arena S√≠/No */
    .arena{
      position:relative;
      width:100%;
      max-width:600px;
      height:170px;
      border-radius:18px;
      background: rgba(34,211,238,.10);
      border: 1px solid rgba(56,189,248,.22);
      overflow:hidden;
      margin-top:12px;
      padding:12px;
      touch-action: none;
    }
    .arena .hint{
      text-align:center;
      color:var(--muted);
      font-weight:900;
      margin-bottom:10px;
    }
    .yes{
      position:absolute;
      left:50%;
      bottom:16px;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--accent2), var(--accent3));
      color:#07203a;
      box-shadow: 0 16px 30px rgba(56,189,248,.25);
      padding:14px 18px;
      min-width:240px;
      will-change: transform;
    }
    .no{
      position:absolute;
      left:14px;
      top:72px;
      background:#ffffff;
      color:#0f172a;
      border:1px solid rgba(2,6,23,.12);
      padding:12px 14px;
      min-width:170px;
    }

    .final{ font-size:18px; font-weight:950; margin: 6px 0 0; color:#0b1224; text-align:center; }
    .small{ font-size:13px; color:var(--muted); margin-top:8px; font-weight:750; text-align:center; }

    .footer{
      padding:14px 18px;
      display:flex;
      gap:10px;
      align-items:center;
      border-top:1px solid rgba(2,6,23,.06);
      background:rgba(255,255,255,.55);
    }
    .dots{display:flex; gap:8px;}
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:rgba(2,6,23,.10);
      transition: transform .25s ease, background .25s ease;
    }
    .dot.on{
      background: rgba(56,189,248,.70);
      transform: scale(1.2);
    }
    .footer .small2{
      margin-left:auto;
      color:var(--muted);
      font-weight:850;
      font-size:13px;
    }

    /* floaties global */
    .floaties{position:fixed; inset:0; pointer-events:none; z-index:1;}
    .floaterGlobal{
      position:absolute;
      font-size:18px;
      opacity:.9;
      animation: rise linear forwards;
      filter: drop-shadow(0 10px 18px rgba(56,189,248,.25));
    }
    @keyframes rise{
      from{transform: translateY(0) rotate(0deg); opacity:0}
      10%{opacity:1}
      to{transform: translateY(-120vh) rotate(240deg); opacity:0}
    }

    canvas{position:fixed; inset:0; pointer-events:none; z-index:3;}

    @media (max-width:480px){
      .big{font-size:24px}
      .arena{height:190px}
      button{min-width:260px}
      .scene{height:380px}
    }
  </style>
</head>

<body>
  <div class="bg-stickers"></div>
  <div class="floaties" id="floaties"></div>
  <canvas id="confetti"></canvas>
  <audio id="bgm" src="musica.mp3" preload="auto" loop></audio>


  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="pill">Invitaci√≥n para Denisse Lorca üíì</div>
        <div class="title" id="toTxt">para mi amor üíì</div>
      </div>
      <div class="storybar" aria-hidden="true"><span id="bar"></span></div>

      <div class="stage">

        <!-- STEP 1 (gatito) -->
        <section class="panel active" data-step="1">
          <div class="cute">üê±üíñüê±</div>
          <h1 class="big">oda mamorcitoo üíì</h1>
          <p class="sub" id="caption">Toca al gatito para que se salte m√°s r√°pido omg üôÄ</p>

          <div class="scene" id="scene">
            <div class="spark" id="spark"></div>

            <div class="catWrap" id="catWrap">
              <img class="cat" id="cat" src="cat_transparent.gif" alt="Gatito feliz" />
              <img class="cat" id="catStill" src="cat_freeze.png" alt="Gatito cansadito" />
            </div>

            <div class="floor"></div>
          </div>

          <div class="small">Pregunta r√°pida: Sab√≠as que te amo much√≠simo? muejejejeüíì</div>

          <div class="actions">
            <button class="btnNext" id="tapBtn">Salta m√°s r√°pido gatoooo üò∫</button>
            <button class="btnSoft" id="skip">Tengo algo que preguntarte... üôÄ</button>
          </div>
        </section>

        <!-- STEP 2 (pregunta) -->
        <section class="panel" data-step="2">
          <div class="cute">üê±‚ú®üíû‚ú®üê±</div>
          <h2 class="big">¬øQuieres ser mi San Valent√≠n? ü•∫üíì</h2>
          <p class="sub">No hay tiempo para pensar, RESPONDEEEEEE</p>

          <div class="arena" id="arena">
            <div class="hint" id="arenaHint">Elige una opci√≥n!!!! üíó</div>
            <button class="no" id="btnNo" aria-label="No">No ü§®</button>
            <button class="yes" id="btnYes" aria-label="S√≠">S√ç!! üíìüíìüíì</button>
          </div>

          <div class="small">Un tip? Te conviene apretar "s√≠" muejeje üòº</div>

          <div class="actions">
            <button class="btnSoft" id="back1">Atr√°s üòæ</button>
          </div>
        </section>

        <!-- STEP 3 (final) -->
        <section class="panel" data-step="3">
          <div class="cute">üéâüê±üíñüê±üéâ</div>
          <h2 class="big">MUEJEJEJEJEJEJE üíìüíì</h2>
          <p class="final" id="finalMsg">Te amo much√≠simo Denisse Lorca, gracias por hacerme tan feliz!! üíñ</p>

          <div class="info" id="infoBox">
            <div class="row"><span class="label">üóìÔ∏è D√≠a</span><span class="value" id="vDate">‚Äî</span></div>
            <div class="row"><span class="label">üìç Lugar</span><span class="value" id="vPlace">‚Äî</span></div>
            <div class="row"><span class="label">üçì Plan</span><span class="value" id="vPlan">‚Äî</span></div>
          </div>

          <div class="actions">
            <button class="btnNext" id="copy">Copiar mensajito üíå</button>
            <button class="btnSoft" id="restart">Ver de nuevo üôÄ</button>
          </div>
        </section>

      </div>

      <div class="footer">
        <div class="dots" aria-hidden="true">
          <span class="dot on" id="d1"></span>
          <span class="dot" id="d2"></span>
          <span class="dot" id="d3"></span>
        </div>
        <div class="small2" id="stepTxt">Paso 1 de 3</div>
      </div>
    </div>
  </div>

  <script>
    // =======================
    // TEXTOS (del 2do c√≥digo)
    // =======================
    const NOMBRE = "Denisse Lorca";
    const DIA = "14/02/2026 üôÄ";
    const LUGAR = "Donde sea pero juntitos jeje";
    const PLAN = "Comer algo rico + pase√≠to pichina jej + muchos besitos üíì";

    const toTxt = document.getElementById("toTxt");
    const bar = document.getElementById("bar");
    const caption = document.getElementById("caption");

    const bgm = document.getElementById("bgm");
    let bgmStarted = false;

    async function startBgm(){
      if (bgmStarted) return;
      bgmStarted = true;
      try{
        bgm.volume = 0.35; // ajusta 0.0 - 1.0
        await bgm.play();  // funciona luego de interacci√≥n
      }catch(e){
        // si fall√≥, no hacemos nada (algunos navegadores son ma√±osos)
        bgmStarted = false;
      }
    }

    // Arrancar m√∫sica en la primera interacci√≥n del usuario
    window.addEventListener("pointerdown", startBgm, { once:true });
    window.addEventListener("keydown", startBgm, { once:true });


    const vDate  = document.getElementById("vDate");
    const vPlace = document.getElementById("vPlace");
    const vPlan  = document.getElementById("vPlan");
    const finalMsg = document.getElementById("finalMsg");

    toTxt.textContent = `Para el amor de mi vida üíì`;
    vDate.textContent  = DIA;
    vPlace.textContent = LUGAR;
    vPlan.textContent  = PLAN;

    // =======================
    // Steps (dise√±o del 1ro)
    // =======================
    const panels = Array.from(document.querySelectorAll(".panel"));
    const stepTxt = document.getElementById("stepTxt");
    const dots = [document.getElementById("d1"), document.getElementById("d2"), document.getElementById("d3")];
    let step = 1;

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    const arena = document.getElementById("arena");
    const btnNo = document.getElementById("btnNo");
    const arenaHint = document.getElementById("arenaHint");

    const btnYes = document.getElementById("btnYes");

    // ------------------------------
    // Anti-missclick: si arrastra, no acepta el "S√≠"
    // ------------------------------
    let downX = 0, downY = 0, moved = false;

    arena.addEventListener("pointerdown", (e)=>{
      downX = e.clientX; downY = e.clientY;
      moved = false;
    }, { passive: true });

    arena.addEventListener("pointermove", (e)=>{
      const dx = Math.abs(e.clientX - downX);
      const dy = Math.abs(e.clientY - downY);
      if(dx > 8 || dy > 8) moved = true;
    }, { passive: true });

    // si el usuario arrastr√≥, NO ejecutar el click en "S√≠"
    btnYes.addEventListener("click", (e)=>{
      if(moved){
        e.preventDefault();
        e.stopPropagation();
        return;
      }
    }, true);


    function moveNo(){
      const a = arena.getBoundingClientRect();
      const b = btnNo.getBoundingClientRect();
      const pad = 10;
      const maxX = a.width - b.width - pad;
      const maxY = a.height - b.height - pad;
      const x = clamp(Math.random()*maxX, pad, maxX);
      const y = clamp(Math.random()*maxY, 56, maxY);
      btnNo.style.left = x + "px";
      btnNo.style.top = y + "px";
    }
    
    function syncStageHeight(){
      const active = document.querySelector(".panel.active");
      if(!active || !stageEl) return;

      // altura real del panel + padding top/bottom de stage
      const h = active.offsetHeight + 18 + 18;
      stageEl.style.height = h + "px";
    }

    const setStep = (n) => {
      step = n;
      panels.forEach(p => p.classList.toggle("active", Number(p.dataset.step) === step));
      stepTxt.textContent = `Paso ${step} de 3`;
      dots.forEach((d,i)=> d.classList.toggle("on", i+1 === step));

      if(step === 2) setTimeout(moveNo, 50);

      // ‚úÖ importante
      requestAnimationFrame(syncStageHeight);
    };


    document.getElementById("skip").onclick = () => setStep(2);
    document.getElementById("back1").onclick = () => setStep(1);

    const stageEl = document.querySelector(".stage");

    // ‚úÖ llama al inicio
    window.addEventListener("load", syncStageHeight);
    window.addEventListener("resize", syncStageHeight);


    // ======================
    // Gatito: ‚Äúm√°s r√°pido‚Äù SIN saltar
    // ======================
    const scene = document.getElementById("scene");
    const catWrap = document.getElementById("catWrap");
    const tapBtn = document.getElementById("tapBtn");
    const spark = document.getElementById("spark");

    let energy = 12;
    let speed = 0;
    let tired = false;
    let cooldownTimer = null;

    function setProgress(){
      const pct = Math.round(((12 - energy) / 12) * 100);
      bar.style.width = pct + "%";
    }
    setProgress();

    function popEmoji(mult = 1){
      for(let k=0;k<mult;k++){
        const e = document.createElement("div");
        e.className = "floater";
        const pool = ["ü©µ","üíô","‚ú®","üò∫","üêæ","üíì","ü•∫"];
        e.textContent = pool[(Math.random()*pool.length)|0];
        e.style.setProperty("--dx", (Math.random()*160 - 80) + "px");
        e.style.setProperty("--dy", (-80 - Math.random()*120) + "px");
        e.style.left = (40 + Math.random()*20) + "%";
        e.style.top = (48 + Math.random()*10) + "%";
        scene.appendChild(e);
        setTimeout(()=> e.remove(), 950);
      }
    }

    function applySpeed(){
      const sparkDur = Math.max(0.55, 1.35 - speed * 0.07);
      spark.style.setProperty("--sparkDur", sparkDur + "s");
    }

    const catImg = document.getElementById("cat");
    const catStill = document.getElementById("catStill");

    function freezeCat(){
      catImg.style.display = "none";
      catStill.style.display = "block";
    }

    function unfreezeCat(){
      catStill.style.display = "none";
      catImg.style.display = "block";
    }


    function becomeTired(){
      tired = true;
      freezeCat();
      caption.textContent = "El gato se cans√≥ de saltar, mucha chamba pipipipi,,,";
      tapBtn.textContent = "El gatito est√° cansadito ü•∫";
      tapBtn.disabled = true;
      setTimeout(()=> {
        caption.textContent = "Bueno, ahora necesito que me ayudes a responder algo...";
        document.getElementById("skip").textContent = "Ir a la pregunta omgg";
      }, 1200);
    }

    function tap(){
      startBgm();

      if(tired) return;

      catWrap.classList.remove("boost");
      void catWrap.offsetWidth;
      catWrap.classList.add("boost");

      energy = Math.max(0, energy - 1);
      speed = Math.min(12, speed + 1);
      setProgress();
      applySpeed();

      popEmoji(speed >= 8 ? 2 : 1);

      if(energy > 6) caption.textContent = "Dale m√°s r√°pido, si es el rayo mcqueen jeje";
      else if(energy > 2) caption.textContent = "M√ÅS RAPIDOOOOOO";
      else caption.textContent = "PERATE WEY ME ESTOY CANSANDO AAAAAA";

      if(energy <= 0){
        becomeTired();
      }else{
        if(cooldownTimer) clearTimeout(cooldownTimer);
        cooldownTimer = setTimeout(()=>{
          speed = Math.max(0, speed - 2);
          applySpeed();
        }, 1800);
      }
    }

    tapBtn.addEventListener("click", tap);
    document.getElementById("cat").addEventListener("click", tap);

    // NO escurridizo
    btnNo.addEventListener("mouseenter", ()=>{ arenaHint.textContent="üò≥ ese bot√≥n es t√≠mido‚Ä¶"; moveNo(); });
    btnNo.addEventListener("pointerdown", (e)=>{ e.preventDefault(); moveNo(); });
    btnNo.addEventListener("touchstart", (e)=>{ e.preventDefault(); moveNo(); }, {passive:false});
    btnNo.addEventListener("focus", ()=>{ btnNo.blur(); moveNo(); });

    // =======================
    // CONFETTI cuando dice S√ç (OPTIMIZADO ü©µ)
    // =======================
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d", { alpha: true, desynchronized: true });

    let DPR = 1;
    function getDprCap(){
      // cap para no matar FPS en pantallas retina
      const raw = window.devicePixelRatio || 1;
      return Math.min(raw, 1.5);
    }

    function resize(){
      DPR = getDprCap();
      const w = window.innerWidth;
      const h = window.innerHeight;

      canvas.width  = Math.floor(w * DPR);
      canvas.height = Math.floor(h * DPR);

      // trabajamos en coordenadas CSS (no gigantes)
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    }
    window.addEventListener("resize", resize);
    resize();

    let confetti = [];
    let running = true;

    function burst(){
      // cantidad adaptativa
      const isSmall = window.innerWidth < 520;
      const count = isSmall ? 80 : 120;

      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random() * window.innerWidth,
          y: -20 - Math.random() * 80,
          vx: (Math.random()*2-1) * 2.2,
          vy: 2.4 + Math.random()*3.6,
          r: 9 + Math.random()*12, // tama√±o en px CSS
          rot: Math.random()*Math.PI*2,
          vr: (Math.random()*2-1)*0.18,
          emoji: Math.random() < 0.36 ? "ü©µ" : (Math.random() < 0.55 ? "‚ú®" : "üê±"),
          life: 0
        });
      }
    }

    function tick(){
      if(!running) return;

      // limpiar en coordenadas CSS
      ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

      // filtrar los que salen
      confetti = confetti.filter(p => p.y < window.innerHeight + 60);

      // dibujar
      for(const p of confetti){
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.life++;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);

        // usar una sola font ‚Äúpor part√≠cula‚Äù (r√°pido suficiente con count ajustado)
        ctx.font = `${p.r}px ${getComputedStyle(document.body).fontFamily}`;
        ctx.fillText(p.emoji, -p.r*0.55, p.r*0.55);

        ctx.restore();
      }

      requestAnimationFrame(tick);
    }
    tick();


    // Floaties global
    const floaties = document.getElementById("floaties");
    const EMOJIS = ["ü©µ","üíô","‚ú®","üê±","üòΩ","ü•∫","üíì"];
    function spawnFloater(){
      const el = document.createElement("div");
      el.className = "floaterGlobal";
      el.textContent = EMOJIS[(Math.random()*EMOJIS.length)|0];
      const left = Math.random()*100;
      const size = 14 + Math.random()*22;
      const dur = 4 + Math.random()*5;
      el.style.left = left + "vw";
      el.style.bottom = "-10vh";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      floaties.appendChild(el);
      setTimeout(()=> el.remove(), dur*1000);
    }
    let floatTimer = setInterval(spawnFloater, 240);

    // Aceptar (S√≠) -> final
    document.getElementById("btnYes").addEventListener("click", ()=>{
      arenaHint.textContent = "AAAAA ü©µü©µü©µ";
      burst();
      // parar confetti luego de 4.5s para ahorrar CPU
      setTimeout(()=> { confetti = []; }, 4500);
      clearInterval(floatTimer);
      floatTimer = setInterval(spawnFloater, 90);

      finalMsg.textContent = "¬°SAB√çA QUE DIR√çAS QUE S√ç MUEJEJEJ! üíìüíì";
      setStep(3);
    });

    // Copiar mensaje
    document.getElementById("copy").addEventListener("click", async ()=>{
      const msg =
`üíñ Hola ${NOMBRE} üíñ
¬øQuieres ser mi San Valent√≠n? ü•∫üò∫

üóìÔ∏è D√≠a: ${DIA}
üìç Lugar: ${LUGAR}
üçì Plan: ${PLAN}

Ti amuu üíì`;
      try{
        await navigator.clipboard.writeText(msg);
        alert("¬°Listo! Copi√© el mensajito üíå (p√©galo en WhatsApp)");
      }catch{
        prompt("Copia este mensaje:", msg);
      }
    });

    // Restart
    document.getElementById("restart").addEventListener("click", ()=>{
      energy = 12;
      speed = 0;
      tired = false;
      tapBtn.disabled = false;
      tapBtn.textContent = "Tocar gatito üò∫‚ú®";
      caption.textContent = "Toca al gatito para que se ponga m√°s contentito üò≥üíû";
      bar.style.width = "0%";
      spark.style.setProperty("--sparkDur", "1.35s");
      if(cooldownTimer) clearTimeout(cooldownTimer);
      setProgress();
      unfreezeCat();
      setStep(1);
    });

    window.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && step === 2) document.getElementById("btnYes").click();
    });
  </script>
</body>
</html>
